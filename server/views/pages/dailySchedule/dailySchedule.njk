{% extends "partials/layout.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/table/macro.njk" import govukTable %}

{% set pageTitle = "Video daily schedule: " + prisonName %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-three-quarters">
            <h1 class="govuk-heading-xl govuk-!-margin-bottom-0">{{ pageTitle }}</h1>
            <span class="govuk-caption-xl govuk-!-margin-bottom-6">{{ now() | formatDate('iiii d MMMM yyyy') }}. Last updated {{ now() | formatDate('HH:mm') }}</span>
        </div>
        <div class="govuk-grid-column-one-quarter">
            {{ govukButton({
                classes: 'govuk-button--secondary hmpps-refresh',
                text: "Refresh schedule"
            }) }}
        </div>
    </div>

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-three-quarters">
            {{ stat({
                heading: "Appointments listed",
                number: 11,
                visuallyHiddenText: "appointments"
            }) }}

            {{ stat({
                heading: "Cancelled appointments",
                number: 1,
                visuallyHiddenText: "appointments",
                link: {
                    href: "/",
                    text: "View",
                    visuallyHiddenText: "all cancelled appointments"
                }
            }) }}

            {{ stat({
                heading: "Missing video links",
                number: 1,
                visuallyHiddenText: "video link"
            }) }}
        </div>
    </div>

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            {% set rows = [] %}

            {% if rows | length %}
                <div class="hmpps-print-and-export">
                    <button class="hmpps-print-and-export--export">Export (.csv file)</button>
                    <button class="hmpps-print-and-export--print">Print schedule</button>
                </div>

                {{ govukTable({
                    attributes: {
                        'data-module': 'moj-sortable-table'
                    },
                    head: [
                        {
                            text: "Prisoner",
                            attributes: {
                                "aria-sort": "ascending"
                            }
                        },
                        {
                            text: "Time"
                        },
                        {
                            text: "Appointment"
                        },
                        {
                            text: "Location"
                        },
                        {
                            text: "Video link"
                        },
                        {
                            text: "Status"
                        },
                        {
                            text: "Action"
                        }
                    ],
                    rows: rows
                }) }}
            {% else %}
                <p class="govuk-body">
                    There are no video appointments scheduled for {{ now() | formatDate('iiii d MMMM yyyy') }}
                </p>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% macro stat(params) %}
    <div class="govuk-grid-column-one-quarter govuk-!-margin-bottom-3 govuk-!-padding-left-0">
        <div class="govuk-hint govuk-!-margin-bottom-0">{{ params.heading }}</div>
        <span class="govuk-heading-l govuk-!-margin-0 govuk-!-padding-0 ">
            <span>{{ params.number }}</span>
            {% if params.visuallyHiddenText %}<span class="govuk-visually-hidden">{{ params.visuallyHiddenText }}</span>{% endif %}
        </span>

        {% if params.link %}
            <p class="govuk-!-margin-bottom-0">
                <a href="{{ params.link.href }}" data-qa="{{ params.link.dataQa }}" class="govuk-!-font-weight-bold govuk-link govuk-link--no-visited-state">
                    {{ params.link.text }}<span class="govuk-visually-hidden">{{ params.link.visuallyHiddenText }}</span>
                </a>
            </p>
        {% endif %}
    </div>
{% endmacro %}
